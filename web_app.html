<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Conecta o webapp ao cliente do Telegram -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <title>Webapp para bot do Telegram</title>
  </head>
  <body>
    <!-- Cria um elemento HTML para mostrar a foto do usuário -->
    <div id="user-photo"></div>
    <!-- Cria um elemento HTML para mostrar a lista de itens -->
    <div id="items-container"></div>
    <!-- Cria um elemento HTML para mostrar a tela de pagamento -->
    <div id="payment-container"></div>
    <!-- Cria um elemento script para o código JavaScript -->
    <script>
      // Cria uma lista de itens disponíveis
      var items = [
        { name: "ChatGPT", price: 10 },
        { name: "Dalle", price: 20 },
        { name: "TextGPT/AudioGPT", price: 30 },
        { name: "Weather", price: 5 },
      ];

      // Cria uma variável para armazenar os dados do usuário, do chat, do tema e do provider_token
      var user_data, chat_data, theme_data, provider_token;

      // Cria uma variável para armazenar os dados da compra
      var purchase_data = {
        product: "",
        quantity: 0,
        price: 0,
      };

      // Cria uma função para mostrar a foto do usuário
      function show_user_photo() {
        // Obtém o elemento HTML onde a foto do usuário será mostrada
        var user_photo = document.getElementById("user-photo");
        // Limpa o conteúdo anterior
        user_photo.innerHTML = "";
        // Cria um elemento img para a foto do usuário
        var img = document.createElement("img");
        // Define o estilo do elemento img
        img.style.width = "100px";
        img.style.height = "100px";
        img.style.borderRadius = "50%";
        img.style.margin = "10px";
        // Define o atributo src do elemento img com a url da foto do usuário
        img.src = user_data.photo_user;
        // Adiciona o elemento img ao elemento user_photo
        user_photo.appendChild(img);
      }

      // Cria uma função para mostrar a lista de itens
      function show_items() {
        // Obtém o elemento HTML onde os itens serão mostrados
        var items_container = document.getElementById("items-container");
        // Limpa o conteúdo anterior
        items_container.innerHTML = "";
        // Cria um elemento HTML para cada item
        for (var i = 0; i < items.length; i++) {
          // Cria um elemento div para o item
          var item_div = document.createElement("div");
          // Define o estilo do elemento div
          item_div.style.display = "flex";
          item_div.style.alignItems = "center";
          item_div.style.justifyContent = "space-between";
          item_div.style.margin = "10px";
          item_div.style.padding = "10px";
          item_div.style.borderRadius = "10px";
          item_div.style.backgroundColor = theme_data.secondary_bg_color;
          // Cria um elemento span para o nome do item
          var item_name = document.createElement("span");
          // Define o estilo do elemento span
          item_name.style.fontWeight = "bold";
          item_name.style.fontSize = "18px";
          // Define o conteúdo do elemento span
          item_name.textContent = items[i].name;
          // Cria um elemento span para o preço do item
          var item_price = document.createElement("span");
          // Define o estilo do elemento span
          item_price.style.fontSize = "16px";
          // Define o conteúdo do elemento span
          item_price.textContent = items[i].price + " BRL";
          // Cria um elemento button para selecionar o item
          var item_button = document.createElement("button");
          // Define o estilo do elemento button
          item_button.style.width = "100px";
          item_button.style.height = "40px";
          item_button.style.borderRadius = "10px";
          item_button.style.backgroundColor = theme_data.accent_color;
          // Define o conteúdo do elemento button
          item_button.textContent = "Selecionar";
          // Define a função que será executada quando o botão for clicado
          item_button.onclick = function () {
            // Define os dados da compra com base no item selecionado
            purchase_data.product = items[i].name;
            purchase_data.quantity = 1;
            purchase_data.price = items[i].price;
            // Mostra a tela de pagamento
            show_payment();
          };
          // Adiciona os elementos span e button ao elemento div
          item_div.appendChild(item_name);
          item_div.appendChild(item_price);
          item_div.appendChild(item_button);
          // Adiciona o elemento div ao elemento items_container
          items_container.appendChild(item_div);
        }
      }

      // Cria uma função para mostrar a tela de pagamento
      function show_payment() {
        // Obtém o elemento HTML onde a tela de pagamento será mostrada
        var payment_container = document.getElementById("payment-container");
        // Limpa o conteúdo anterior
        payment_container.innerHTML = "";
        // Cria um elemento HTML para mostrar os detalhes da compra
        var purchase_details = document.createElement("div");
        // Define o estilo do elemento div
        purchase_details.style.display = "flex";
        purchase_details.style.flexDirection = "column";
        purchase_details.style.alignItems = "center";
        purchase_details.style.justifyContent = "center";
        purchase_details.style.margin = "10px";
        purchase_details.style.padding = "10px";
        purchase_details.style.borderRadius = "10px";
        purchase_details.style.backgroundColor = theme_data.secondary_bg_color;
        // Cria um elemento span para mostrar o produto selecionado
        var product_span = document.createElement("span");
        // Define o estilo do elemento span
        product_span.style.fontWeight = "bold";
        product_span.style.fontSize = "18px";
        // Define o conteúdo do elemento span
        product_span.textContent =
          "Produto: " + purchase_data.product + " x " + purchase_data.quantity;
        // Cria um elemento span para mostrar o preço total da compra
        var price_span = document.createElement("span");
        // Define o estilo do elemento span
        price_span.style.fontSize = "16px";
        // Define o conteúdo do elemento span
        price_span.textContent =
          "Preço total: " + purchase_data.price * purchase_data.quantity + " BRL";
        // Adiciona os elementos span ao elemento div
        purchase_details.appendChild(product_span);
        purchase_details.appendChild(price_span);
        // Adiciona o elemento div ao elemento payment_container
        payment_container.appendChild(purchase_details);
        // Cria um elemento button para iniciar o pagamento
        var payment_button = document.createElement("button");
        // Define o estilo do elemento button
        payment_button.style.width = "200px";
        payment_button.style.height = "60px";
        payment_button.style.borderRadius = "10px";
        payment_button.style.backgroundColor = theme_data.accent_color;
        // Define o conteúdo do elemento button
        payment_button.textContent = "Pagar";
        // Define a função que será executada quando o botão for clicado
        payment_button.onclick = function () {
          // Inicia o pagamento usando a API de pagamentos do Telegram
          window.Telegram.WebApp.openInvoice({
            title: purchase_data.product,
            description: purchase_data.product + " x " + purchase_data.quantity,
            payload: "productpayload",
            provider_token: provider_token,
            start_parameter: "start",
            currency: "BRL",
            prices: [
              {
                label: purchase_data.product,
                amount: purchase_data.price * purchase_data.quantity * 100,
              },
            ],
          });
          // Envia os dados da compra para o bot usando o método sendData
          window.Telegram.WebApp.sendData(JSON.stringify(purchase_data));
        };
        // Adiciona o elemento button ao elemento payment_container
        payment_container.appendChild(payment_button);
      }

      // Cria uma função para inicializar o webapp
      function init_webapp() {
        // Obtém os dados do usuário, do chat, do tema e do provider_token usando o método getWebAppData
        user_data = window.Telegram.WebApp.getWebAppData().user;
        chat_data = window.Telegram.WebApp.getWebAppData().chat;
        theme_data = window.Telegram.WebApp.getWebAppData().theme;
        provider_token = window.Telegram.WebApp.getWebAppData().provider_token;
      }

      // Chama a função init_webapp quando a página for carregada
      window.onload = init_webapp;

      // Chama a função show_user_photo quando a página for carregada
      window.onload = show_user_photo;

      // Chama a função show_items quando o botão principal for clicado
      window.Telegram.WebApp.onMainButtonClick(show_items);
    </script>
  </body>
</html>
